# Driver Activity Recognition - Configuration
# CNN+LSTM pipeline for Drive&Act dataset (Kinect IR)

data:
  root: "./data"                    # Local path (override for Colab)
  annotation_dir: "activities_3s/kinect_ir"
  annotation_file: "midlevel.chunks_90.csv"
  video_dir: "kinect_ir"
  split: 0                          # Which pre-defined split to use (0, 1, or 2)
  view: "kinect_ir"
  min_segment_frames: 8             # Filter segments shorter than this

model:
  backbone: "resnet18"
  feature_dim: 512                  # ResNet-18 output dimension
  lstm_hidden: 256                  # Run 3 value (best MPCA)
  lstm_layers: 2
  lstm_dropout: 0.3                 # Run 3 value
  fc_dropout: 0.5
  num_classes: 39                   # Will be overridden by actual data count
  freeze_mode: "layer4"             # "all" | "layer4" | "partial" | "none"
  freeze_cnn: true                  # Legacy flag (freeze_mode takes precedence in end_to_end)
  use_layernorm: true               # LayerNorm on LSTM input
  bidirectional: true               # Bidirectional LSTM
  pooling: "attention"              # "last" | "mean" | "attention"

training:
  mode: "feature_based"             # "feature_based" | "end_to_end"
  batch_size: 32
  accumulation_steps: 1
  lr: 0.001                         # LSTM learning rate (Run 3)
  cnn_lr: 0.00001                   # CNN fine-tuning LR (used in end_to_end mode)
  cnn_warmup_epochs: 3              # Freeze CNN for first N epochs (end_to_end mode)
  use_amp: false                    # Mixed precision (enable for end_to_end)
  weight_decay: 0.0001              # Run 3 value
  use_weighted_sampler: true        # WeightedRandomSampler (Run 3)
  en_beta: 0.99                     # EN beta for sampler weights (Run 3)
  epochs: 50
  early_stop_patience: 12
  label_smoothing: 0.1
  loss_type: "ce"                   # "ce" | "focal"
  focal_gamma: 2.0                  # Focal loss focusing parameter
  mixup_alpha: 0.0                  # Mixup interpolation strength (0 = disabled)
  noise_std: 0.0                    # Gaussian noise on input features
  gradient_clip: 1.0
  scheduler_type: "plateau"
  scheduler_factor: 0.5
  scheduler_patience: 5
  num_workers: 2                    # Colab compatible
  seed: 42

cnn_finetune:
  batch_size: 64                    # Single frames, can use larger batch
  epochs: 15
  early_stop_patience: 7
  cnn_lr: 0.0001                    # CNN layer4 LR
  fc_lr: 0.001                      # Classifier head LR
  weight_decay: 0.0001
  label_smoothing: 0.1
  gradient_clip: 1.0
  use_amp: true
  use_weighted_sampler: true

processing:
  seq_length: 16                    # Number of frames per sequence
  frame_size: 224
  original_fps: 30
  sample_fps: 5                     # Temporal subsampling rate
  ir_mean: 0.5                      # Placeholder — compute from data via compute_dataset_statistics()
  ir_std: 0.25                      # Placeholder — compute from data via compute_dataset_statistics()

features:
  save_dir: "features"              # Relative to data.root ("features_finetuned" for Run 6a)
  dtype: "float32"                  # float32 for better numerical precision

output:
  checkpoint_dir: "results/checkpoints"
  log_dir: "results/logs"
  figure_dir: "results/figures"
